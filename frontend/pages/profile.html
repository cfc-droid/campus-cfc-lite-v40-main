<script>
document.getElementById("btnStats").addEventListener("click", () => {
  const prev = document.querySelector("#miProgresoOverlay");
  if (prev) prev.remove();

  const totalSeconds = parseFloat(localStorage.getItem("CFC_time_total") || 0);
  const minutes = Math.floor(totalSeconds / 60);
  const hours = Math.floor(minutes / 60);
  const remMin = minutes % 60;

  const data = JSON.parse(localStorage.getItem("progressData") || "{}");
  const completed = (data.completed || []).length;
  const percent = Math.floor((completed / 20) * 100);

  let lastDate = localStorage.getItem("CFC_lastDate");
  if (!lastDate || lastDate === "â€”") {
    const today = new Date().toLocaleDateString("es-AR");
    localStorage.setItem("CFC_lastDate", today);
    lastDate = today;
  }

  const consecutive = localStorage.getItem("CFC_days") || 0;
  const totalDays = localStorage.getItem("CFC_totalDays") || 0;

  const overlay = document.createElement("div");
  overlay.id = "miProgresoOverlay";
  overlay.style = `
    position:fixed;inset:0;z-index:99999;
    background:rgba(0,0,0,0.88);color:#FFD700;
    font-family:'Poppins',sans-serif;display:flex;
    justify-content:center;align-items:center;flex-direction:column;
    text-align:center;line-height:1.6;opacity:0;
    transition:opacity .6s ease-in-out;
  `;

  overlay.innerHTML = `
    <div style="
      max-width:480px;
      padding:30px;
      background:rgba(40,40,40,0.85);
      backdrop-filter:blur(10px);
      border:1px solid #FFD700;
      border-radius:14px;
      box-shadow:0 0 25px rgba(255,215,0,0.5);
      text-align:left;
    ">
      <h2 style="text-align:center;">ğŸ“Š Tu progreso</h2>
      <ul style="list-style:none;padding-left:0;font-size:0.95rem;line-height:1.8;">
        <li>ğŸ“˜ <b>MÃ³dulos completados:</b> ${completed}/20 (${percent}%)</li>
        <li>â±ï¸ <b>Horas activas:</b> ${hours} h ${remMin} min</li>
        <li>ğŸ“… <b>Ãšltima sesiÃ³n:</b> ${lastDate}</li>
        <li>ğŸ” <b>DÃ­as consecutivos de estudio:</b> ${consecutive}</li>
        <li>ğŸ—“ï¸ <b>DÃ­as totales de estudio:</b> ${totalDays}</li>
      </ul>
      <div style="text-align:center;margin-top:20px;">
        <button id="cerrarProgreso" class="btn-main">Cerrar</button>
      </div>
    </div>
  `;

  document.body.appendChild(overlay);
  setTimeout(() => (overlay.style.opacity = 1), 50);

  document.getElementById("cerrarProgreso").addEventListener("click", () => {
    overlay.style.opacity = 0;
    setTimeout(() => overlay.remove(), 300);
  });

  console.log(
    "ğŸ§© CFC_SYNC checkpoint:",
    `Progreso actualizado â†’ ${hours}h ${remMin}min â€” ${percent}% â€” Ãšltima sesiÃ³n: ${lastDate}`,
    new Date().toLocaleString()
  );
});
</script>

<!-- ğŸ”’ CFC_LOCK: V41.33-profile_overlayFixLastDate-20251106 -->
